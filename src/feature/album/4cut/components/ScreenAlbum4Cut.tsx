'use client';
import CustomHeader from '@/global/components/header/CustomHeader';
import LongButton from '@/global/components/LongButton';
import ConfirmModal from '@/global/components/modal/ConfirmModal';
import Toast from '@/global/components/toast/Toast';
import BubbleHint from '@/global/components/tooltip/BubbleTooltip';
import PersonSvg from '@/global/svg/PersonSvg';
import { Download, LucideIcon, Menu, Send } from 'lucide-react';
import { useRouter } from 'next/navigation';
import { useState } from 'react';
import Container4Cut from './Container4Cut';

interface ScreenAlbum4CutProps {
  albumId: string;
}

export default function ScreenAlbum4Cut({ albumId }: ScreenAlbum4CutProps) {
  const router = useRouter();
  const [isConfirmed, setIsConfirmed] = useState(false);
  // TODO : maker Ïó¨Î∂Ä apiÌÜµÌï¥ ÌôïÏù∏
  const isMaker = false;

  const handleConfirm = () => {
    // TODO : ÏπòÏ¶àÎÑ§Ïª∑ ÌôïÏ†ï
    setIsConfirmed(true);
  };

  const handleDownload = () => {
    // TODO : Îã§Ïö¥Î°úÎìú Î°úÏßÅ
    console.log('Îã§Ïö¥Î°úÎìú ÌÅ¥Î¶≠');
  };

  const handleShare = () => {
    // TODO : Í≥µÏú† Î°úÏßÅ
    console.log('Í≥µÏú†ÌïòÍ∏∞ ÌÅ¥Î¶≠');
  };

  return (
    <>
      <CustomHeader
        isShowBack
        title='ÍπÄÏàòÌïúÎ¨¥Í±∞Î∂ÅÏù¥ÏôÄÎëêÎ£®ÎØ∏ÏÇºÏ≤ú'
        rightContent={
          <div className='flex gap-4'>
            <button
              type='button'
              onClick={() => router.push(`/album/detail/${albumId}/sidebar`)}
            >
              <Menu width={24} height={24} color='var(--color-icon-basic)' />
            </button>
          </div>
        }
      />
      <section className='absolute top-[46%] left-1/2 flex -translate-x-1/2 -translate-y-1/2 flex-col items-center'>
        <div className='typo-body-lg-semibold mb-2'>ÌòÑÏû¨ TOP 4 ÏÇ¨ÏßÑ</div>
        <Container4Cut albumId={albumId} />
      </section>

      <div className='fixed bottom-5 flex w-full max-w-[430px] flex-col items-center px-4'>
        {isMaker ? (
          <>
            {isConfirmed ? (
              <div className='flex w-full justify-center gap-3'>
                <ActionButton
                  icon={Download}
                  text='Îã§Ïö¥Î°úÎìú'
                  onClick={handleDownload}
                />
                <ActionButton
                  icon={Send}
                  text='Í≥µÏú†ÌïòÍ∏∞'
                  onClick={handleShare}
                />
              </div>
            ) : (
              <>
                <div className='typo-body-sm-semibold flex items-center gap-2 pb-3'>
                  <span>Îù± ÏßÑÌñâÏÉÅÌô©</span>
                  <div className='flex items-center'>
                    <span className='p-[5px]'>
                      <PersonSvg />
                    </span>
                    <span>7 / 8 Î™Ö</span>
                  </div>
                </div>
                <ConfirmModal
                  trigger={<LongButton text='ÏÇ¨ÏßÑ ÌôïÏ†ïÌïòÍ∏∞' noFixed />}
                  title='Ïù¥ÎåÄÎ°ú ÌôïÏ†ïÌïòÏãúÍ≤†Ïñ¥Ïöî?'
                  description='ÏòàÏÅú ÏπòÏ¶àÎÑ§Ïª∑ÏùÑ ÎßåÎì§Ïñ¥ÎìúÎ¶¥Í≤åÏöî'
                  confirmText='ÌôïÏ†ïÌïòÍ∏∞'
                  onConfirm={handleConfirm}
                />
              </>
            )}
          </>
        ) : (
          <div className=''>
            <BubbleHint
              message='üì∏ ÏÇ¨ÏßÑ ÌôïÏ†ï Í∂åÌïúÏùÄ Î©îÏù¥Ïª§ÏóêÍ≤åÎßå ÏûàÏñ¥Ïöî'
              className='absolute bottom-18 left-1/2 w-full -translate-x-1/2'
            />
            <LongButton
              text='Î©îÏù¥Ïª§ÏóêÍ≤å Ï°∞Î•¥Í∏∞'
              onClick={async () => {
                // TODO : share api Î™®ÎìàÌôî Î∞è Í∞úÏÑ†
                if (navigator.share) {
                  try {
                    await navigator.share({
                      title: `'Ï°∏ÏóÖÏãù'Ïï®Î≤îÏóê ÎåÄÌïú ÏπòÏ¶àÎÑ§Ïª∑ÏùÑ ÏÑ†Ï†ïÌï¥Ï£ºÏÑ∏Ïöî`,
                      text: 'Ïù¥Ïú†Ï†ïÎãòÏù¥ ÏûÑÎØºÏÑú Î©îÏù¥Ïª§ÎãòÏóêÍ≤å Ï°∞Î•¥Í∏∞Î•º ÏöîÏ≤≠ÌñàÏñ¥Ïöî!',
                      url: 'https://say-cheese.me/album/4cut/1',
                    });
                  } catch (err) {
                    console.error('Í≥µÏú† Ï∑®ÏÜå ÎòêÎäî Ïã§Ìå®:', err);
                    Toast.alert(
                      'Í≥µÏú†Ïóê Ïã§Ìå®ÌïòÏòÄÏäµÎãàÎã§. Îã§ÏãúÌïúÎ≤à ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.',
                    );
                  }
                } else {
                  Toast.alert(
                    'Ïù¥ Î∏åÎùºÏö∞Ï†ÄÎäî Í≥µÏú†ÌïòÍ∏∞ Í∏∞Îä•ÏùÑ ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.',
                  );
                }
              }}
            />
          </div>
        )}
      </div>
    </>
  );
}

interface ActionButtonProps {
  icon: LucideIcon;
  text: string;
  onClick: () => void;
}

const ActionButton = ({ icon: Icon, text, onClick }: ActionButtonProps) => (
  <button
    type='button'
    onClick={onClick}
    className='bg-button-tertiary-fill text-text-subtle flex flex-1 items-center justify-center gap-1 rounded-[8px] py-[15px]'
  >
    <Icon width={24} height={24} color='var(--color-icon-basic)' />
    <span className='typo-body-1xl-semibold'>{text}</span>
  </button>
);
